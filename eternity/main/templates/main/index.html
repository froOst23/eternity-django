{% extends "main/base.html" %}

{% load static %}

{% load split_filter %}
{% load comment_count %}

{% block title %}

    eternity | Лента

{% endblock %}

{% block content %}

    {% if post %}

        {% for i in post %}

            <div class="post-wrapper">
                <div class="post">
                    <div class="post-head" style="display: flex;">

                        {% for j in profile %}

                            {% if i.author == j.user %}
                            
                                {% if j.photo %}

                                    <img src="/media/{{ j.photo }}" class="post-img-mini">
                                
                                {% else %}
                                
                                    <img src="{% static 'main/images/default_avatar.png' %}" class="post-img-mini">

                                {% endif %}

                            {% endif %}

                        {% endfor %}
                            
                        <div style="display: grid;">
                            <a href="/accounts/profile/id{{ i.author.id }}" class="post-link font-bold-medium" style="align-self: flex-start; font-size: 16.5px;">{{ i.author }}</a>
                            <span class="inflex-left post-text-header font-regular-small" style="align-self: flex-start; color: gray;">
                                {% for j in profile %}

                                    {% if j.user == i.author %}

                                        {% if j.is_online == True %}

                                            Online

                                        {% else %}

                                            Offline

                                        {% endif %}

                                    {% endif %}

                                {% endfor %}
                            </span> 
                            <span class="inflex-left post-text-header font-regular-small" style="align-self: flex-start; color: gray;">
                                {{ i.date|date:'d.m.Y в H:i' }}
                            </span> 
                        </div>
                    </div>
                    <div class="post-content">
                        <span class="font-bold-large inflex-left post-text">
                            {{ i.title }}
                        </span>
                        <div class="post-tag" style="margin-bottom: 10px;">

                            {% for j in i.tag|split %}

                            <div class="post-tag-text font-italic-small">
                                <a href="/tag/{{ j }}" class="tag-link">#{{ j }}</a>
                            </div>

                            {% endfor %}

                        </div>
                        <div class="flex-left post-title font-regular-medium"></div>
                        {% if i.image %}
                        <div class="flex-center">
                            <img src="/media/{{ i.image }}" class="post-img">
                        </div>
                        {% endif %}
                        <div class="inflex-left post-text-short font-regular-medium">
                            {{ i.content }}
                        </div>

                        {% if request.user !=  i.author %}


                        <div class="post-button font-regular-small flex-right">
                            <a href="/post/{{ i.id }}/add-comment?next={{ request.path }}" class="button">Комментарии {% comment_count i.title %}</a>
                            <a href="/post/{{ i.id }}" class="button">Читать дальше</a>
                        </div>

                        {% else %}
                        
                        <div class="post-button font-regular-small flex-right">
                            <a href="/post/{{ i.id }}/update?next={{ request.path }}" class="button">Изменить</a>
                            <a href="/post/{{ i.id }}/delete" class="button-alert">Удалить</a>
                            <a href="/post/{{ i.id }}/add-comment?next={{ request.path }}" class="button">Комментарии {% comment_count i.title %}</a>    
                            <a href="/post/{{ i.id }}" class="button">Читать дальше</a>
                        </div>

                        {% endif %}

                    </div>
                </div>
            </div>
            
        {% endfor %}

    {% else %}    
        
        <main class="post-wrapper-mini">
            <div class="post">
                <div class="post-head">
                    <div class="post-content">
                        <span class="font-bold-large inflex-center post-title" style="padding-bottom: 20px; padding-top: 20px;">
                            Упс... Записей не обнаружено...
                        </span>
                    </div>
                </div>
                <div class="post-content">
                    <span class="font-regular-medium flex-center" style="padding-bottom: 40px;">
                        По запросу ничего не найдено :(
                    </span>
                </div>
            </main>

    {% endif %}
            
{% endblock %}
